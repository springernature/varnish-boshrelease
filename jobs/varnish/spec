---
name: varnish

templates:
  bpm.yml.erb: config/bpm.yml
  varnish_wrapper.erb: bin/varnish_wrapper
  pre-start.erb: bin/pre-start
  default.vcl.erb: etc/default.vcl

packages:
  - jemalloc
  - pcre
  - tini
  - varnish

properties:
  listen_address:
    description: "Defines what address Varnish should listen to, and service HTTP requests from."
    default: ":80"
  vcl_configuration:
    description: "Content of VCL configuration file"
    default: []
    example:
      vcl_configuration: |
        vcl 4.1;
        backend default {
          .host = "www.example.org";
          .port = "80";
        }

  storage:
    description: "Defines storage backend(s): '-s <[name=]type[,options]>'"
    default: []
    example:
      storage:
        - type: malloc        # required
          name: myStorage     # optional
          options: 0          # optional
  parameters:
    description: "Set parameters passed to varnishd as '-p <name=value>'. This option can be used multiple times to specify multiple parameters."
    default: []
    example:
      parameters:
        - name: default_ttl
          value: 0
        - name: nuke_limit
          value: 500
